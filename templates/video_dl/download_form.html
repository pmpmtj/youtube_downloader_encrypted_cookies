{% extends 'base.html' %}

{% block title %}Download Video - YouTube Downloader{% endblock %}

{% block content %}
<h1>Download YouTube Video</h1>

<div class="alert alert-success">
    <strong>Welcome, {{ user.email }}!</strong> You can now download videos from YouTube.
</div>

{% if download_stats %}
<div class="alert alert-info">
    <strong>Download Quota:</strong> You have {{ download_stats.downloads_remaining }} downloads remaining this hour.
    {% if not ip_allowed %}
    <br><span class="text-warning">⚠️ Rate limit reached. Please wait before downloading again.</span>
    {% endif %}
</div>
{% endif %}

{% if cookie_status.has_cookies %}
<div class="alert alert-success">
    <strong><i class="fas fa-cookie-bite"></i> Cookies Active:</strong> 
    {{ cookie_status.expires_in_hours|floatformat:1 }} hours remaining
    <a href="{% url 'accounts:cookie_management' %}" class="btn btn-sm btn-outline-success ml-2">
        <i class="fas fa-cog"></i> Manage
    </a>
</div>
{% else %}
<div class="alert alert-warning">
    <strong><i class="fas fa-exclamation-triangle"></i> No Cookies:</strong> 
    Upload your YouTube cookies for better download reliability.
    <a href="{% url 'accounts:cookie_management' %}" class="btn btn-sm btn-warning ml-2">
        <i class="fas fa-upload"></i> Upload Cookies
    </a>
</div>
{% endif %}

<form method="post" id="downloadForm">
    {% csrf_token %}
    <div class="form-group">
        <input type="url" name="url" placeholder="Paste YouTube URL…" required class="form-control" />
    </div>
    
    <div class="form-group">
        <div class="checkbox-container">
            <label class="checkbox-label">
                <input type="checkbox" name="download_to_remote" id="downloadToggle" checked>
                Download to my computer
            </label>
            <small class="text-muted">Uncheck to save to server only</small>
        </div>
    </div>
    
    <button type="submit" class="btn btn-block">Download Video</button>
</form>

<small class="text-muted" id="downloadDescription">The best available video (prefers .mp4) will download directly to your computer.</small>

<div class="mt-4">
    <a href="{% url 'accounts:dashboard' %}" class="btn btn-secondary">Back to Dashboard</a>
    <a href="{% url 'audio_dl:index' %}" class="btn btn-outline-secondary">Download Audio Instead</a>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkbox = document.getElementById('downloadToggle');
    const description = document.getElementById('downloadDescription');
    
    function updateDescription() {
        if (checkbox.checked) {
            description.textContent = 'The best available video (prefers .mp4) will download directly to your computer.';
        } else {
            description.textContent = 'The best available video (prefers .mp4) will be saved to the server only.';
        }
    }
    
    checkbox.addEventListener('change', updateDescription);
    
    // Initialize description on page load
    updateDescription();
});
</script>
{% endblock %}
